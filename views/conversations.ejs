<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Dumpster Diver ‚Äì Conversations</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="container">
    <div class="page-header">
      <h1>Your Conversations</h1>
      <p style="color: var(--text-secondary);">Browse through your ChatGPT conversation history</p>
    </div>
    
    <div class="search-container">
      <input 
        type="search" 
        id="search" 
        class="search-input" 
        placeholder="üîç Search conversation titles..." 
        onkeyup="filter()"
        autocomplete="off"
      >
      <div id="search-results" style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
        <span id="result-count"><%= conversations.length %></span> conversations found
      </div>
    </div>
    
    <div id="conversation-list">
      <% conversations.forEach(conv => { %>
        <div class="conversation-item fade-in">
          <a href="/conversation/<%= conv.id %>?session=<%= session %>">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 1rem;">
              <div style="flex: 1; min-width: 0;">
                <div style="font-weight: 500; margin-bottom: 0.25rem; word-break: break-word;">
                  <%= conv.title || 'Untitled Conversation' %>
                </div>
                <div class="conversation-date">
                  <%= conv.date %>
                </div>
              </div>
              <div style="color: var(--primary-blue); font-size: 1.25rem; flex-shrink: 0;">
                ‚Üí
              </div>
            </div>
          </a>
        </div>
      <% }) %>
    </div>
    
    <% if (conversations.length === 0) { %>
      <div class="card empty-state">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
        <h3>No conversations found</h3>
        <p style="color: var(--text-secondary);">
          No conversations were found in this session. Try uploading a different ChatGPT export file.
        </p>
        <a href="/" style="margin-top: 1rem; display: inline-block;">
          <button class="secondary">‚Üê Back to Upload</button>
        </a>
      </div>
    <% } %>
    
    <div style="margin-top: 3rem; text-align: center;">
      <a href="/" style="color: var(--text-muted); font-size: 0.875rem;">
        ‚Üê Back to Upload
      </a>
    </div>
  </div>
  
  <script>
    function filter() {
      const searchTerm = document.getElementById('search').value.toLowerCase();
      const items = document.querySelectorAll('.conversation-item');
      let visibleCount = 0;
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        const isVisible = text.includes(searchTerm);
        item.style.display = isVisible ? 'block' : 'none';
        
        if (isVisible) {
          visibleCount++;
          // Add fade-in animation for newly visible items
          if (!item.classList.contains('fade-in')) {
            item.classList.add('fade-in');
          }
        }
      });
      
      // Update result count
      const resultCount = document.getElementById('result-count');
      const totalItems = items.length;
      if (searchTerm) {
        resultCount.textContent = `${visibleCount} of ${totalItems}`;
      } else {
        resultCount.textContent = totalItems;
      }
      
      // Show/hide "no results" message
      const noResults = document.getElementById('no-results');
      if (visibleCount === 0 && searchTerm) {
        if (!noResults) {
          const noResultsDiv = document.createElement('div');
          noResultsDiv.id = 'no-results';
          noResultsDiv.className = 'card fade-in';
          noResultsDiv.style.textAlign = 'center';
          noResultsDiv.style.padding = '2rem';
          noResultsDiv.innerHTML = `
            <div style="font-size: 2rem; margin-bottom: 1rem;">üîç</div>
            <h3>No conversations found</h3>
            <p style="color: var(--text-secondary);">
              No conversations match "${searchTerm}". Try a different search term.
            </p>
          `;
          document.getElementById('conversation-list').appendChild(noResultsDiv);
        }
      } else if (noResults) {
        noResults.remove();
      }
    }
    
    // Add keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === '/' && document.activeElement !== document.getElementById('search')) {
        e.preventDefault();
        document.getElementById('search').focus();
      }
      
      if (e.key === 'Escape') {
        document.getElementById('search').blur();
        document.getElementById('search').value = '';
        filter();
      }
    });
    
    // Add search highlighting
    document.getElementById('search').addEventListener('input', function(e) {
      const searchTerm = e.target.value;
      if (searchTerm.length > 2) {
        // You could implement text highlighting here if desired
      }
    });
    
    // Initialize with fade-in animation
    document.addEventListener('DOMContentLoaded', function() {
      const items = document.querySelectorAll('.conversation-item');
      items.forEach((item, index) => {
        setTimeout(() => {
          item.style.opacity = '0';
          item.style.transform = 'translateY(10px)';
          item.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          
          setTimeout(() => {
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
          }, 50);
        }, index * 50);
      });
    });
  </script>
</body>
</html>